<div class="container mt-4">
  <h2>Liste des Demandes de Contrat</h2>

  <!-- Recherche -->
  <div class="mb-3">
    <input type="text" [(ngModel)]="searchText" class="form-control" placeholder="Rechercher...">
  </div>

  <!-- Chargement -->
  <div *ngIf="isLoading" class="text-center my-4">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Chargement...</span>
    </div>
  </div>

  <!-- Tableau -->
  <div class="table-responsive" *ngIf="!isLoading && filteredDemandes.length > 0">
    <table class="table table-striped table-bordered">
      <thead>
        <tr>
          <th>ID</th>
          <th>Description</th>
          <th>Statut</th>
          <th>Client</th>
          <th>Entreprise</th>
          <th>Date de Demande</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let demande of filteredDemandes | paginate: { itemsPerPage: itemsPerPage, currentPage: currentPage }"
            [ngClass]="{
              'table-warning': demande.statut?.toLowerCase() === 'en_attente',
              'table-success': demande.statut?.toLowerCase() === 'accepter',
              'table-danger': demande.statut?.toLowerCase() === 'annulee',
              'disabled-row': demande.disabled
            }">
          <td>{{ demande.id }}</td>
          <td>{{ demande.description }}</td>
          <td>{{ demande.statut }}</td>
          <td>{{ demande.client?.email }}</td>
          <td>{{ demande.client?.entreprise }}</td>
          <td>{{ demande.dateDemande | date:'dd/MM/yyyy HH:mm' }}</td>
          <td>
            <ng-container *ngIf="demande.statut === 'en_attente'">
              <button *ngIf="!isClient " class="btn btn-light btn-sm w-50 mt-1" (click)="acceptDemandeContrat(demande.id)">
                <i class="fas fa-check text-success"></i>
              </button>
              <button *ngIf="!isClient" class="btn btn-light btn-sm w-50 mt-1" (click)="cancelDemandeContrat(demande.id)">
                <i class="fas fa-times text-danger"></i>
              </button>
              <button *ngIf="isClient" class="btn btn-light btn-sm w-50 mt-1" (click)="editDemandeContrat(demande)">
                <i class="fas fa-edit text-primary"></i>
              </button>
              <button *ngIf="isClient" class="btn btn-light btn-sm w-50 mt-1" (click)="disableRow(demande)">
                <i class="fas fa-trash text-danger"></i>
              </button>
            </ng-container>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="d-flex justify-content-center" *ngIf="!isLoading && filteredDemandes.length > 0">
    <pagination-controls
      (pageChange)="currentPage = $event"
      previousLabel="Précédent"
      nextLabel="Suivant"
      [responsive]="true">
    </pagination-controls>
  </div>

  <!-- Aucune donnée -->
  <div *ngIf="!isLoading && filteredDemandes.length === 0" class="alert alert-info">
    Aucune demande de contrat trouvée.
  </div>
</div>
