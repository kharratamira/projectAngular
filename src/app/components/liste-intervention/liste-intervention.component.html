<div class="container mt-4">
    <h2 class="mb-4">Liste des Interventions</h2>
  
    <!-- Chargement -->
    <div *ngIf="isLoading" class="text-center my-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Chargement...</span>
      </div>
    </div>
  
    <!-- Aucune donnée -->
    <div *ngIf="!isLoading && interventions.length === 0" class="alert alert-info">
      Aucune intervention trouvée.
    </div>
  
    <!-- Liste des interventions -->
    <div *ngIf="!isLoading && interventions.length > 0" class="table-responsive">
      <table class="table table-striped table-hover">
        <thead class="table-dark">
          <tr>
            <th>ID Int.</th>
            <th>ID Dem.</th>
            <th>Client</th>
            <th>Technicien</th>
            <th>Description</th>
            <th>Dates</th>
            <th>Observation</th>
            <th>Tâches</th>
          </tr>
          <!-- Ligne des champs de filtre -->
          <tr class="bg-light">
            <th>
              <input
                type="text"
                class="form-control form-control-sm"
                placeholder="Filtrer ID Int."
                [(ngModel)]="filterInterventionId"
                (input)="applyFilters()"
              />
            </th>
            <th>
              <input
                type="text"
                class="form-control form-control-sm"
                placeholder="Filtrer ID Dem."
                [(ngModel)]="filterDemandeId"
                (input)="applyFilters()"
              />
            </th>
            <th>
              <input
                type="text"
                class="form-control form-control-sm"
                placeholder="Filtrer Client"
                [(ngModel)]="filterClient"
                (input)="applyFilters()"
              />
            </th>
            <th>
              <input
                type="text"
                class="form-control form-control-sm"
                placeholder="Filtrer Technicien"
                [(ngModel)]="filterTechnicien"
                (input)="applyFilters()"
              />
            </th>
            <th>
              <input
                type="text"
                class="form-control form-control-sm"
                placeholder="Filtrer Description"
                [(ngModel)]="filterDescription"
                (input)="applyFilters()"
              />
            </th>
            <th>
              <input
                type="text"
                class="form-control form-control-sm"
                placeholder="Filtrer Date Début"
                [(ngModel)]="filterDateDebut"
                (input)="applyFilters()"
              />
              <input
                type="text"
                class="form-control form-control-sm mt-1"
                placeholder="Filtrer Date Fin"
                [(ngModel)]="filterDateFin"
                (input)="applyFilters()"
              />
            </th>
            <th></th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let interv of filteredInterventions | paginate: { itemsPerPage: itemsPerPage, currentPage: currentPage }">
            <!-- ID Intervention -->
            <td>{{ interv.intervention_id }}</td>
  
            <!-- ID Demande -->
            <td>{{ interv.demande?.id || '-' }}</td>
  
            <!-- Client -->
            <td>
              <div *ngIf="interv.client">
                <strong>{{ interv.client.entreprise || '-' }}</strong><br />
                {{ interv.client.prenom }} {{ interv.client.nom }}
              </div>
              <div *ngIf="!interv.client">-</div>
            </td>
  
            <!-- Technicien -->
            <td>
              {{ interv.technicien?.prenom || '-' }} {{ interv.technicien?.nom || '-' }}
            </td>
  
            <!-- Description -->
            <td>{{ interv.demande?.description || '-' }}</td>
  
            <!-- Dates -->
            <td>
              <strong>Debut:</strong> {{ formatDate(interv.affectation_date_prevu) }}<br />
              <strong>Fin:</strong> {{ formatDate(interv.date_fin) }}
            </td>
  
            <!-- Observation -->
            <td>{{ interv.observation || '-' }}</td>
  
            <!-- Tâches -->
            <td>
              <button class="btn btn-sm btn-primary" (click)="showTachesPopup(interv)">
                Voir tâches ({{ interv.taches?.length || 0 }})
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <pagination-controls
    (pageChange)="currentPage = $event"
    class="mt-3"
    previousLabel="Précédent"
    nextLabel="Suivant"
  ></pagination-controls>
  </div>